"use strict";function getMinimalStyling(){return[{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#d3d3d3"}]},{featureType:"transit",stylers:[{color:"#808080"},{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"on"},{color:"#b3b3b3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ffffff"},{weight:1.8}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#d7d7d7"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ebebeb"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#a7a7a7"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#efefef"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#696969"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{visibility:"on"},{color:"#737373"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#d6d6d6"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#dadada"}]}]}function getMarkerIconColors(){return{color:"ffc40d",highlight:"cc0000"}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},brewhouseData=[{title:"Rock Bottom Restaurant & Brewery",coordinates:{lat:43.039697,lng:-87.911528},address:"740 N Plankinton Ave, Milwaukee, WI 53203",neighborhood:"Westown",tag:["brewery","restaurant"],info:"Amazing food and hand-crafted, small batch beers are waiting for you at Rock Bottom.",url:"https://rockbottom.com/locations/milwaukee/",yelpID:"rock-bottom-restaurant-and-brewery-milwaukee"},{title:"Milwaukee Ale House",coordinates:{lat:43.033472,lng:-87.909467},address:"233 N Water St, Milwaukee, WI 53202",neighborhood:"Historic Third Ward",tag:["brewery","restaurant","live music"],info:"The Ale House is the place in the Third Ward for live music, hand-crafted ales and lagers, and riverside dining.",url:"http://ale-house.com/",yelpID:"milwaukee-ale-house-milwaukee"},{title:"Broken Bat Brewing Co.",coordinates:{lat:43.033501,lng:-87.908003},address:"231 E. Buffalo St. - Lower Unit, Milwaukee, WI 53202",neighborhood:"Historic Third Ward",tag:["bar","brewery"],info:"Hand-crafted beer and baseball. What else could you want?. This brew house offers you a twist with beers infused with mint, apricot, orange peel, and more.  Try to Mint Condition Porter.",url:"http://brokenbatbrewery.com/",yelpID:"broken-bat-brewing-co-llc-milwaukee"},{title:"Water Street Brewery",coordinates:{lat:43.044783,lng:-87.911197},address:"1101 N Water St, Milwaukee, WI 53202",neighborhood:"East Town",tag:["brewery","restaurant"],info:"Water Street offers a wide array of ambers, ales, stouts, and seasonal beers.  My favorite is their Baltic Porter with robust blend of dark chocolate and toffee.",url:"http://www.waterstreetbrewery.com/index.html/locations/downtown",yelpID:"water-street-brewery-milwaukee"},{title:"Lakefront Brewery",coordinates:{lat:43.054726,lng:-87.905287},address:"1872 N Commerce St, Milwaukee, WI 53212",neighborhood:"Brewer's Hill",tag:["brewery","restaurant"],info:"Head up to Brewer's Hill on Friday night to enjoy the fish fry and hand-crafted IPA, Ale, or Lager.  The Eastside Dark, a Bavarian Dark Lager, is my favorite at Lakefront.",url:"http://www.lakefrontbrewery.com/",yelpID:"lakefront-brewery-milwaukee"}],_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),InfoWindowView=function(){function InfoWindowView(map){_classCallCheck(this,InfoWindowView),this.map=map,this.infoWindow=new google.maps.InfoWindow({maxWidth:300})}return _createClass(InfoWindowView,[{key:"close",value:function(){this.infoWindow.close()}},{key:"render",value:function(placeModel){arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.infoWindow.close(),this.infoWindow.marker=placeModel.marker,this.infoWindow.setContent(this.buildHTML(placeModel)),this.infoWindow.open(this.map,placeModel.marker)}},{key:"renderSpinner",value:function(placeModel){this.infoWindow.close(),this.infoWindow.marker=placeModel.marker,this.infoWindow.setContent(this.buildSpinnerHTML(placeModel)),this.infoWindow.open(this.map,placeModel.marker)}},{key:"buildSpinnerHTML",value:function(placeModel){return'<div class="brewhouse-info-container">\n          <h2>'+placeModel.title()+'</h2>\n          <div class="brewhouse-info">\n            <div class="brewhouse-info-content">\n                <p>Please wait as we connect Yelp...</p>\n            </div>\n            <div class="brewhouse-info-content">\n                <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span class="sr-only">Loading...</span>\n            </div>\n          </div>\n        </div>'}},{key:"buildHTML",value:function(placeModel){var links='<a href="'+placeModel.url+'" target="_blank">website</a>',tags='<i class="fa fa-beer" aria-hidden="true"></i>';placeModel.tag().includes("restaurant")&&(tags+='<i class="fa fa-cutlery" aria-hidden="true"></i>'),placeModel.tag().includes("live music")&&(tags+='<i class="fa fa-music" aria-hidden="true"></i>');var html='<div class="brewhouse-info-container">\n          <h2>'+placeModel.title()+'</h2>\n          <div class="brewhouse-info">\n            <div class="brewhouse-info-content">\n              <p class="brewhouse-tags">'+tags+"</p>\n              <p><strong>My Review:</strong> "+placeModel.marker.info+'</p>\n            </div>\n            <div class="brewhouse-info-content">\n                <p>'+placeModel.address+"</p>";return placeModel.hasYelpData()&&(html+="<p>Yelp Rating: "+placeModel.yelpData.rating+"</p>",links+=' | <a href="'+placeModel.yelpData.url+'" target="_blank">Yelp</a>'),html+=links+"</div>\n          </div>\n        </div>"}}]),InfoWindowView}(),_typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return void 0===obj?"undefined":_typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":void 0===obj?"undefined":_typeof2(obj)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),PlaceModel=function(){function PlaceModel(data,id){_classCallCheck(this,PlaceModel),this.isVisible=ko.observable(!0),this.id=id,this.title=ko.observable(data.title),this.coordinates=data.coordinates,this.info=data.info,this.neighborhood=data.neighborhood,this.tag=ko.observableArray(data.tag),this.url=data.url,this.address=data.address,this.yelpID=data.yelpID,this.yelpData=null}return _createClass(PlaceModel,[{key:"hasYelpData",value:function(){return null!==this.yelpData&&("object"===_typeof(this.yelpData)&&this.yelpData.hasOwnProperty("rating"))}},{key:"setYelpData",value:function(data){this.yelpData=data}},{key:"makeVisible",value:function(){this.isVisible()||(this.isVisible(!0),this.marker.setVisible(!0))}},{key:"hide",value:function(){this.isVisible()&&(this.isVisible(!1),this.marker.setVisible(!1),this.marker.setAnimation(null))}},{key:"initMarker",value:function(map,icon){return this.marker=new google.maps.Marker({position:this.coordinates,map:map,title:this.title(),icon:icon,animation:google.maps.Animation.DROP,id:this.id,info:this.info}),this.marker}},{key:"setMarkerAnimation",value:function(){var _this=this;this.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){_this.marker.setAnimation(null)},750)}}]),PlaceModel}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ViewModel=function(){function ViewModel(placeModels){var _this=this;_classCallCheck(this,ViewModel),this.appRunning=ko.observable(!1),this.appError=ko.observable(!1),this.nameFilter=ko.observable(""),this.places=ko.observableArray(placeModels),this.menuOpen=ko.observable(!1),this.markers=[],this.filteredPlaces=ko.computed(function(){return _this.filterPlaces()})}return _createClass(ViewModel,[{key:"init",value:function(){this.appRunning(!0),this.map=new google.maps.Map(document.getElementById("map"),{center:{lat:43.045758,lng:-87.906},zoom:this.getMapZoom(),styles:getMinimalStyling(),mapTypeControl:!1}),this.infoWindow=new InfoWindowView(this.map)}},{key:"initMarkers",value:function(){var self=this,mapBounds=new google.maps.LatLngBounds;this.initIconStyling(),this.places().forEach(function(placeModel){placeModel.initMarker(self.map,self.iconStyling.defaultIcon),self.markers.push(placeModel.marker),mapBounds.extend(placeModel.marker.position),placeModel.marker.addListener("click",function(){return self.openInfoWindow.call(self,placeModel)}),placeModel.marker.addListener("mouseover",function(){return placeModel.marker.setIcon(self.iconStyling.highlightedIcon)}),placeModel.marker.addListener("mouseout",function(){return placeModel.marker.setIcon(self.iconStyling.defaultIcon)})})}},{key:"getMapZoom",value:function(){return window.innerWidth>1e3&&window.innerHeight>900?15:14}},{key:"initIconStyling",value:function(){this.iconStyling={defaultIcon:this.getMarkerIcon(getMarkerIconColors().color),highlightedIcon:this.getMarkerIcon(getMarkerIconColors().highlight)}}},{key:"getMarkerIcon",value:function(markerColor){return new google.maps.MarkerImage("https://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+markerColor+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34))}},{key:"filterPlaces",value:function(){var filterby=this.nameFilter().toLowerCase();return void 0!==this.infoWindow&&this.infoWindow.close(),filterby?this.places().filter(function(place){var placeMatched=place.title().toLowerCase().substring(0,filterby.length)===filterby;return placeMatched?place.makeVisible():place.hide(),placeMatched}):(this.places().forEach(function(place){return place.makeVisible()}),this.places())}},{key:"openInfoWindow",value:function(placeModel){this.infoWindow!==placeModel.marker&&(placeModel.setMarkerAnimation(),this.getYelp(placeModel,this.infoWindow.render))}},{key:"setPlace",value:function(self,placeModel){self.openInfoWindow.call(self,placeModel)}},{key:"toggleSidebar",value:function(){this.menuOpen(!this.menuOpen())}},{key:"getYelp",value:function(placeModel,cb){var infoWindow=this.infoWindow;if(placeModel.hasYelpData())return cb.call(infoWindow,placeModel);this.infoWindow.renderSpinner.call(infoWindow,placeModel),fetch("yelp",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({location:"Milwaukee, WI",term:placeModel.title()})}).then(function(response){if(200!==response.status)return console.log("Whoops, an error occurred with status code "+response.status),cb.call(infoWindow,placeModel,!0);response.json().then(function(data){return placeModel.setYelpData(JSON.parse(data)),cb.call(infoWindow,placeModel)})}).catch(function(err){return console.log(err),cb.call(infoWindow,placeModel,!0)})}}]),ViewModel}(),getAllModels=function(data){var locations=[];return data.forEach(function(location,index){return locations.push(new PlaceModel(location,index))}),locations},initMap=function(){setTimeout(function(){app.init(),app.initMarkers()},1e3)},initError=function(){app.appError(!0)};setTimeout(function(){app.appRunning()&&window.google&&window.google.maps||initError()},5e3);var app=new ViewModel(getAllModels(brewhouseData));ko.applyBindings(app);